<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
            rel="stylesheet"
    />
    <link
            href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined"
            rel="stylesheet"
    />
    <script type="importmap">
        {
          "imports": {
            "@material/web/": "https://esm.run/@material/web/"
          }
        }
    </script>
    <script type="module">
        import "@material/web/all.js";
        import {styles as typescaleStyles} from "@material/web/typography/md-typescale-styles.js";

        document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>

    <link rel="stylesheet" th:href="@{/css/admin-page/betting/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-page/common.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-page/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-page/category/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-page/font.css}"/>
</head>
<body>
<div id="main">
    <div id="sidebar" th:replace="content/admin-page/fragments/sidebar.html"></div>
    <div id="wrapper">
        <section>
            <div class="admin-main-head">
                <div class="subject"><h1>카테고리목록</h1></div>
                <div>
                    <a th:onclick="createClick()">
                        <md-filled-tonal-button class="create-button"
                        >등록버튼
                        </md-filled-tonal-button
                        >
                    </a>
                    <md-filled-tonal-button
                            class="delete-button"
                            onclick="showDeleteDialog()"
                    >삭제버튼
                    </md-filled-tonal-button
                    >
                </div>
            </div>
            <div id="admin-main-title">
                <div class="checkbox">
                    <span>선택</span>
                </div>
                <div class="title">
                    <span>카테고리명</span>
                </div>
            </div>

            <!--            삭제 전용 form-->
            <div class="admin-main-body" th:each="item: ${category}">
                <div class="main-node">
                    <div class="checkbox">
                        <form action="#" id="delete-form" method="post" th:action="@{/admin-page/category/delete}">
                            <md-checkbox th:name="ids" th:value="${item.getCategoryNo()}" touch-target="wrapper">
                            </md-checkbox>
                        </form>
                    </div>
                    <!--                        <div class="title" onclick="updateNotification(event)" th:data-id="${item.getCategoryNo()}">-->
                    <div class="title" th:data-id="${item.getCategoryNo()}" onclick="updateClick(event)">
                            <span class=".category-span"
                                  th:text="${item.getCategoryName()}"></span>
                    </div>
                </div>
            </div>

            <div class="dialog-overlay" id="delete-dialog">
                <div class="dialog">
                    <p>정말 삭제하시겠습니까?</p>
                    <button form="delete-form" onclick="confirmDelete()" type="submit">삭제</button>
                    <button onclick="cancelDelete()">취소</button>
                </div>
            </div>

            <form id="create-form" method="post" th:action="@{/admin-page/category/create}">
                <div class="dialog-overlay" id="create-dialog">
                    <div class="dialog">
                        <p>등록할 카테고리를 입력해주세요</p>
                        <div>
                            <md-outlined-text-field
                                    id="category-name"
                                    label="카테고리명"
                                    name="categoryName"
                                    required></md-outlined-text-field>
                        </div>
                        <button form="create-form" onclick="confirmDelete()" type="submit">등록</button>
                        <button onclick="cancelCreate()">취소</button>
                    </div>
                </div>
            </form>

            <form id="update-form" method="post" th:action="@{/admin-page/category/update}">
                <div class="dialog-overlay" id="update-dialog">
                    <div class="dialog">
                        <p id="update-name-refresh">카테고리 이름을 변경하시겠습니까?</p>
                        <p>새로운 이름을 입력하세요.</p>
                        <div>
                            <md-outlined-text-field
                                    id="category-update-name"
                                    label="카테고리명"
                                    name="categoryName"
                                    autocomplete="off"
                                    required></md-outlined-text-field>
                        </div>
                        <input type="hidden" id="data-set-id" name="categoryNo" value="" />
                        <button onclick="confirmDelete()" type="submit">수정</button>
                        <button onclick="cancelUpdate()" type="button">취소</button>
                    </div>
                </div>
            </form>

            <script>
                function updateClick(event) {
                    document.getElementById("data-set-id").value = event.currentTarget.getAttribute("data-id");
                    document.getElementById("update-name-refresh").innerText = `${event.target.innerText} 카테고리 이름을 변경하시겠습니까?`;
                    document.getElementById("update-dialog").style.display = "flex";
                }

                function cancelUpdate() {
                    document.getElementById("category-update-name").reset();
                    document.getElementById("update-dialog").style.display = "none";
                }
            </script>

            <script>
                function createClick() {
                    document.getElementById("create-dialog").style.display = "flex";
                }

                function cancelCreate() {
                    document.getElementById("create-dialog").style.display = "none";
                }

            </script>

            <script>
                function updateNotification(event) {
                    console.log(document.getQuerySelector('data-id'))
                    const data_id = event.currentTarget.getAttribute("data-id");
                    window.location.href = `./category/${data_id}`
                }

            </script>
            <!-- 삭제 dialog -->
            <script>
                const status = document.getElementsByClassName("status");
                for (const item of status) {
                    if (item.innerText === '상태') {
                        continue;
                    }
                    item.style.color = 'green'
                    if (item.innerText === "종료") {
                        item.style.color = 'red';
                    }
                }

                // innerText
                function showDeleteDialog() {
                    // 체크된게 있으면 체크
                    const checkboxes = document.querySelectorAll(
                        ".admin-main-body md-checkbox"
                    );
                    if (!Array.from(checkboxes).some((checkbox) => checkbox.checked)) {
                        return;
                    }
                    document.getElementById("delete-dialog").style.display = "flex";
                }

                function confirmDelete() {
                    // deleteNode();
                    document.getElementById("delete-dialog").style.display = "none";
                }

                function cancelDelete() {
                    document.getElementById("delete-dialog").style.display = "none";
                }
            </script>
        </section>
        <div id="paginnation-frame">

            <!--            <a th:href="@{/admin-page/notification(page=${currentPage - 1})}">Previous</a>-->
            <md-icon-button th:href="@{/admin-page/category(page=${currentPage - 1})}">
                <md-icon class="material-symbols-outlined">
                    arrow_back_ios
                </md-icon>
            </md-icon-button>


            <div th:each="page : ${#numbers.sequence(start, end)}">
                <div class="active">
                    <a th:if="${page == currentPage}" th:text="${page}"></a>
                </div>
                <div>
                    <a th:href="@{/admin-page/category(page=${page})}" th:if="${page != currentPage}"
                       th:text="${page}"></a>
                </div>
            </div>

            <md-icon-button th:href="@{/admin-page/category(page=${currentPage + 1})}">
                <md-icon class="material-symbols-outlined">
                    arrow_forward_ios
                </md-icon>
            </md-icon-button>
            <!--            <a th:href="@{/admin-page/notification(page=${currentPage + 1})}">Next</a>-->
        </div>
    </div>
</div>
</body>
</html>