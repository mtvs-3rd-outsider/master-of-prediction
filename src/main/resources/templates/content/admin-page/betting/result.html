<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="@{/}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">

    <script type="importmap">
        {
          "imports": {
            "@material/web/": "https://esm.run/@material/web/"
          }
        }
    </script>
    <script type="module">
        import "@material/web/all.js";
        import {styles as typescaleStyles} from "@material/web/typography/md-typescale-styles.js";

        document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>

    <link rel="stylesheet" th:href="@{/css/admin-page/index.css}">
    <link rel="stylesheet" th:href="@{/css/admin-page/notification/create.css}">
    <link rel="stylesheet" th:href="@{/css/admin-page/betting/update.css}">
    <link rel="stylesheet" th:href="@{/css/admin-page/font.css}">
</head>
<body>
<div id="main">
    <div id="sidebar" th:replace="content/admin-page/fragments/sidebar.html"></div>
    <div id="wrapper">
        <section id="response-section">
            <div class="admin-main-head">
                <h1 th:attr="data-id=${betting.subjectNo}">배팅상품 수정</h1>
                <h1 th:text="${betting.subjectNo}">테스트</h1>
            </div>
            <div class="admin-main-body-frame">
                <form id="send-data" method="post"
                      onsubmit="return validateForm()"
                      th:action="@{/admin-page/betting/result/{id}(id=${betting.subjectNo})}"
                      th:object="${betting}">
                    <div class="admin-main-body">
                        <div class="custom-file-input">
                            <img class="img-tag" th:src="*{attachmentFileAddress}"/>
                            <input class="file-input" onchange="previewImage(event)" type="file"/>
                        </div>
                        <div class="create-notification-title">
                            <h2>주제</h2>
                            <md-outlined-text-field id="notification-text-field" name="title"
                                                    th:attr="value=${betting.subjectTitle}"
                                                    th:field="*{subjectTitle}"
                                                    th:readonly="readonly"
                            ></md-outlined-text-field>
                        </div>
                        <div>
                            <span>카테고리</span>
                            <select class="body-value" name="subjectCategoryNo" th:value="${betting.subjectCategoryNo}">
                                <option th:value="${category.categoryNo}"
                                        th:text="${category.categoryName}"></option>
                            </select>
                        </div>
                        <div>
                            <span>날짜</span>
                            <input id="calendar" class="body-value" name="deadline" th:value="${deadline}" type="date" th:readonly="readonly"/>
                        </div>
                    </div>
                </form>
                <div id="button-frame">
                    <md-filled-tonal-button class="cansle-button" id="result-button">결과발표</md-filled-tonal-button>
                    <md-filled-tonal-button class="cansle-button" onclick="history.back()">취소</md-filled-tonal-button>
                </div>

                <div id="result-frame">
                    <md-text-button class="result-yes-button" th:onclick="resultClick('Yes')"
                    >Yes
                    </md-text-button
                    >
                    <md-text-button class="result-no-button" th:onclick="resultClick('No')">No</md-text-button>
                </div>
                <form method="post" th:action="@{/admin-page/betting/result/{id}(id=${betting.getSubjectNo()})}">
                    <div class="dialog-overlay" id="delete-dialog" style="display: none">
                        <div class="dialog">
                            <p id="selection-result"></p>
                            <input id="result-choose"   type="hidden" value=""/>
<!--                            <input name="subjectNo" th:attr="value=${betting.getSubjectNo()}" type="hidden"/>-->
                            <p>결과를 발표하시겠습니까?</p>
                            <button onclick="confirmSend()" form="send-data" type="submit">발표</button>
                            <button onclick="cancelSend()" type="button">취소</button>
                        </div>
                    </div>
                </form>
            </div>
        </section>
    </div>
</div>
<!--결과발표 선택 dialog-->
<script>
    function resultClick(result) {
        document.getElementById('result-choose').value = result;
        document.getElementById('selection-result').textContent = result + '를 선택하셨습니다.';
        document.getElementById('delete-dialog').style.display = 'flex';
    }

    function confirmSend() {
        document.getElementById('delete-dialog').style.display = 'none';
    }

    function cancelSend() {
        document.getElementById('delete-dialog').style.display = 'none';
    }


</script>


<!--결과발표 toggle-->
<script>
    const toggleButton = document.querySelector('#result-button');
    const container = document.querySelector('#result-frame');
    container.setAttribute('class', 'remove');
    toggleButton.addEventListener('click', () => {
        if (container.getAttribute('class', 'remove')) {
            container.removeAttribute('class', 'remove');
        } else {
            container.setAttribute('class', 'remove');
        }
    })
</script>
<!--이미지 태그 미리보기-->
<script>
    function previewImage(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onloadend = function () {
            document.getElementsByClassName("img-tag")[0].src = reader.result;
        };
        if (file) {
            reader.readAsDataURL(file);
        } else {
            document.getElementsByClassName("img-tag")[0].src = "";
        }
    }
</script>
<script>
    function validateForm() {
        const textField = document.getElementById("notification-text-field");
        const textArea = document.getElementById("notification-text-body");

        if (
            textField.value.trim("").length == 0 ||
            textArea.value.trim("").length == 0
        ) {
            return false;
        }
        // 등록 로직 추가
        return true;
        // window.location.href = "./";
    }
</script>
</body>
</html>