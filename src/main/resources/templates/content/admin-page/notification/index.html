<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
            rel="stylesheet"
    />
    <link
            href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined"
            rel="stylesheet"
    />
    <script type="importmap">
        {
          "imports": {
            "@material/web/": "https://esm.run/@material/web/"
          }
        }
    </script>
    <script type="module">
        import "@material/web/all.js";
        import {styles as typescaleStyles} from "@material/web/typography/md-typescale-styles.js";

        document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>

    <link rel="stylesheet" th:href="@{/css/admin-page/notification/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-page/common.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-page/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-page/font.css}"/>
</head>
<body>
<div id="main">
    <div id="sidebar" th:replace="content/admin-page/fragments/sidebar.html"></div>
    <div id="wrapper">
        <section>
            <div class="admin-main-head">
                <div class="subject"><h1>공지사항</h1></div>
                <div>
                    <a href="/admin-page/notification/create-form">
                        <md-filled-tonal-button class="create-button"
                        >등록버튼
                        </md-filled-tonal-button
                        >
                    </a>
                    <md-filled-tonal-button
                            class="delete-button"
                            onclick="showDeleteDialog()"
                    >삭제버튼
                    </md-filled-tonal-button
                    >
                </div>
            </div>
            <div id="admin-main-title">
                <div class="notice-checkbox">
                    <span>선택</span>
                </div>
                <div class="notice-title">
                    <span>제목</span>
                </div>
                <div class="notice-timestamp">
                    <span>작성일</span>
                </div>
            </div>

            <!--            삭제 전용 form-->
            <form action="#" id="delete-form" method="post" th:action="@{/admin-page/notification/delete}">
                <div class="admin-main-body" th:each="notice: ${notices}">
                    <div class="main-node">
                        <div class="notice-checkbox">
                            <md-checkbox th:name="ids" th:value="${notice.id}" touch-target="wrapper">
                            </md-checkbox>
                        </div>
                        <div class="notice-title" onclick="updateNotification(event)" th:data-id="${notice.id}">
                            <span th:text="${notice.title}"></span>
                        </div>
                        <div class="notice-timestamp">
                            <span class="timestamp" th:text="${notice.timestamp}"></span>
                        </div>
                    </div>
                </div>
            </form>


            <div class="dialog-overlay" id="delete-dialog">
                <div class="dialog">
                    <p>정말 삭제하시겠습니까?</p>
                    <button form="delete-form" onclick="confirmDelete()" type="submit">삭제</button>
                    <button onclick="cancelDelete()">취소</button>
                </div>
            </div>

            <!-- 게시글 삽입 -->
            <!--        <script>-->
            <!--          const adminMainBody =-->
            <!--            document.getElementsByClassName("admin-main-body")[0];-->
            <!--          let node = "";-->
            <!--          for (let index = 0; index < 20; index++) {-->
            <!--            node +=-->
            <!--              `<div class="main-node" data-id=${index} onclick="updateNotification(event)"><md-checkbox touch-target="wrapper"></md-checkbox>\-->
            <!--          <span>6월 27일 시스템 점검 안내</span></div>`;-->
            <!--          }-->
            <!--          adminMainBody.innerHTML = node;-->
            <!--        </script>-->

            <!-- 게시글 삭제 -->
            <!--            <script>-->
            <!--                function deleteNode() {-->
            <!--                    const checkboxes = document.querySelectorAll(-->
            <!--                        ".admin-main-body md-checkbox"-->
            <!--                    );-->

            <!--                    checkboxes.forEach((checkbox) => {-->
            <!--                        // md-checkbox 요소에 체크 상태를 나타내는 클래스가 있는지 확인-->
            <!--                        if (checkbox.checked) {-->
            <!--                            // 체크된 항목의 부모 요소(main-node)를 찾아서 DOM에서 제거-->
            <!--                            const parentNode = checkbox.closest(".main-node");-->
            <!--                            if (parentNode) {-->
            <!--                                parentNode.remove();-->
            <!--                            }-->
            <!--                        }-->
            <!--                    });-->
            <!--                }-->
            <!--            </script>-->

            <!--        게시글 클릭 시 수정 페이지로-->
            <script>
                function updateNotification(event) {
                    const data_id = event.currentTarget.getAttribute("data-id");
                    window.location.href = `./notification/${data_id}`
                }

            </script>
            <!-- 삭제 dialog -->
            <script>
                function showDeleteDialog() {
                    // 체크된게 있으면 체크
                    const checkboxes = document.querySelectorAll(
                        ".admin-main-body md-checkbox"
                    );
                    if (!Array.from(checkboxes).some((checkbox) => checkbox.checked)) {
                        return;
                    }
                    document.getElementById("delete-dialog").style.display = "flex";
                }

                function confirmDelete() {
                    // deleteNode();
                    document.getElementById("delete-dialog").style.display = "none";
                }

                function cancelDelete() {
                    document.getElementById("delete-dialog").style.display = "none";
                }
            </script>
        </section>
        <div id="paginnation-frame">

            <!--            <a th:href="@{/admin-page/notification(page=${currentPage - 1})}">Previous</a>-->
            <md-icon-button th:href="@{/admin-page/notification(page=${currentPage - 1})}">
                <md-icon class="material-symbols-outlined">
                    arrow_back_ios
                </md-icon>
            </md-icon-button>


            <div th:each="page : ${#numbers.sequence(start, end)}">
                <div class="active" >
                    <a th:if="${page == currentPage}" th:text="${page}"></a>
                </div>
                <div>
                    <a th:href="@{/admin-page/notification(page=${page})}" th:if="${page != currentPage}"
                       th:text="${page}"></a>
                </div>
            </div>

            <md-icon-button th:href="@{/admin-page/notification(page=${currentPage + 1})}">
                <md-icon class="material-symbols-outlined">
                    arrow_forward_ios
                </md-icon>
            </md-icon-button>
            <!--            <a th:href="@{/admin-page/notification(page=${currentPage + 1})}">Next</a>-->
        </div>
    </div>
</div>
</body>
</html>